\section{The small-step interpreter for big-step semantics}\label{appendix-interp}

\begin{figure}
%\begin{tabular}{l}
\begin{lstlisting}[basicstyle=\scriptsize\ttfamily]
run([]).
run([A]) :- bigStepPred(A),smallStep(A,As1),run(As1).

smallStep(A,[]) :- leaf(A),clpClause(_,A,Bs),callPreds(Bs).
smallStep(bigstep(A,St0,St1),As1) :-
	nonLeaf(bigstep(A,St0,St1)),
	clpClause(K,bigstep(A,St0,St1),[B|Bs]),
	evalConditions([B|Bs],[B1|Bs1]),
	nextStep([B1|Bs1],K,As1).
	
nextStep([A|Bs],_,Bs1) :-
	leaf(A),evalConditions(Bs,Bs1),smallStep(A,[]).
nextStep([bigstep(A,St0,St1)|Bs],K,[H]) :-
	nonLeaf(bigstep(A,St0,St1)),
	smallStep(bigstep(A,St0,St1),[bigstep(U,V,W)]),
	tryFold(K,H,[bigstep(U,V,W)|Bs]).
	
tryFold(_,B1,[B1]).
tryFold(K,H,[B1|Bs]) :- Bs \== [],clpClause(K,H,[B1|Bs]).
	
evalConditions([],[]).
evalConditions([B|Bs],[B|Bs]) :- bigStepPred(B).
evalConditions([B|Bs],Bs1) :-
	otherPred(B),eval(B),evalConditions(Bs,Bs1).

eval(B) :- constraint(B),call(B).
eval(B) :- clpClause(_,B,B1),callPreds(B1).
	
callPreds([]).
callPreds([B|Bs]) :- eval(B),callPreds(Bs).
		
otherPred(B) :- constraint(B).
otherPred(A) :- clpClause(_,otherPred(A),[]).

leaf(A) :- clpClause(_,leaf(A),[]).
nonLeaf(A) :- clpClause(_,nonLeaf(A),[]).
bigStepPred(A) :- clpClause(_,bigStepPred(A),[]).

otherPred(A) :- clpClause(_,otherPred(A),[]).

constraint(_ = _).  constraint(_ < _).  constraint(_ > _).
constraint(_ =< _). constraint(_ >= _). constraint(_ is _).
constraint(_ =:= _). constraint(_\==_). constraint(_\=_).
\end{lstlisting}
%\end{tabular}
\caption{The small-step interpreter for big-step semantics.}\label{fig:linear-bigstep-full}
\end{figure}



